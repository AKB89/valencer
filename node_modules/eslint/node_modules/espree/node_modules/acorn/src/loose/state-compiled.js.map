{"version":3,"sources":["state.js"],"names":[],"mappings":"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","file":"state-compiled.js","sourcesContent":["import {tokenizer, SourceLocation, tokTypes as tt, Node, lineBreak, isNewLine} from \"..\"\n\n// Registered plugins\nexport const pluginsLoose = {}\n\nexport class LooseParser {\n  constructor(input, options) {\n    this.toks = tokenizer(input, options)\n    this.options = this.toks.options\n    this.input = this.toks.input\n    this.tok = this.last = {type: tt.eof, start: 0, end: 0}\n    if (this.options.locations) {\n      let here = this.toks.curPosition()\n      this.tok.loc = new SourceLocation(this.toks, here, here)\n    }\n    this.ahead = [] // Tokens ahead\n    this.context = [] // Indentation contexted\n    this.curIndent = 0\n    this.curLineStart = 0\n    this.nextLineStart = this.lineEnd(this.curLineStart) + 1\n    // Load plugins\n    this.options.pluginsLoose = options.pluginsLoose || {}\n    this.loadPlugins(this.options.pluginsLoose)\n  }\n\n  startNode() {\n    return new Node(this.toks, this.tok.start, this.options.locations ? this.tok.loc.start : null)\n  }\n\n  storeCurrentPos() {\n    return this.options.locations ? [this.tok.start, this.tok.loc.start] : this.tok.start\n  }\n\n  startNodeAt(pos) {\n    if (this.options.locations) {\n      return new Node(this.toks, pos[0], pos[1])\n    } else {\n      return new Node(this.toks, pos)\n    }\n  }\n\n  finishNode(node, type) {\n    node.type = type\n    node.end = this.last.end\n    if (this.options.locations)\n      node.loc.end = this.last.loc.end\n    if (this.options.ranges)\n      node.range[1] = this.last.end\n    return node\n  }\n\n  dummyNode(type) {\n    let dummy = this.startNode()\n    dummy.type = type\n    dummy.end = dummy.start\n    if (this.options.locations)\n      dummy.loc.end = dummy.loc.start\n    if (this.options.ranges)\n      dummy.range[1] = dummy.start\n    this.last = {type: tt.name, start: dummy.start, end: dummy.start, loc: dummy.loc}\n    return dummy\n  }\n\n  dummyIdent() {\n    let dummy = this.dummyNode(\"Identifier\")\n    dummy.name = \"✖\"\n    return dummy\n  }\n\n  dummyString() {\n    let dummy = this.dummyNode(\"Literal\")\n    dummy.value = dummy.raw = \"✖\"\n    return dummy\n  }\n\n  eat(type) {\n    if (this.tok.type === type) {\n      this.next()\n      return true\n    } else {\n      return false\n    }\n  }\n\n  isContextual(name) {\n    return this.tok.type === tt.name && this.tok.value === name\n  }\n\n  eatContextual(name) {\n    return this.tok.value === name && this.eat(tt.name)\n  }\n\n  canInsertSemicolon() {\n    return this.tok.type === tt.eof || this.tok.type === tt.braceR ||\n      lineBreak.test(this.input.slice(this.last.end, this.tok.start))\n  }\n\n  semicolon() {\n    return this.eat(tt.semi)\n  }\n\n  expect(type) {\n    if (this.eat(type)) return true\n    for (let i = 1; i <= 2; i++) {\n      if (this.lookAhead(i).type == type) {\n        for (let j = 0; j < i; j++) this.next()\n        return true\n      }\n    }\n  }\n\n  pushCx() {\n    this.context.push(this.curIndent)\n  }\n\n  popCx() {\n    this.curIndent = this.context.pop()\n  }\n\n  lineEnd(pos) {\n    while (pos < this.input.length && !isNewLine(this.input.charCodeAt(pos))) ++pos\n    return pos\n  }\n\n  indentationAfter(pos) {\n    for (let count = 0;; ++pos) {\n      let ch = this.input.charCodeAt(pos)\n      if (ch === 32) ++count\n      else if (ch === 9) count += this.options.tabSize\n      else return count\n    }\n  }\n\n  closes(closeTok, indent, line, blockHeuristic) {\n    if (this.tok.type === closeTok || this.tok.type === tt.eof) return true\n    return line != this.curLineStart && this.curIndent < indent && this.tokenStartsLine() &&\n      (!blockHeuristic || this.nextLineStart >= this.input.length ||\n       this.indentationAfter(this.nextLineStart) < indent)\n  }\n\n  tokenStartsLine() {\n    for (let p = this.tok.start - 1; p >= this.curLineStart; --p) {\n      let ch = this.input.charCodeAt(p)\n      if (ch !== 9 && ch !== 32) return false\n    }\n    return true\n  }\n\n  extend(name, f) {\n    this[name] = f(this[name])\n  }\n\n  loadPlugins(pluginConfigs) {\n    for (let name in pluginConfigs) {\n      let plugin = pluginsLoose[name]\n      if (!plugin) throw new Error(\"Plugin '\" + name + \"' not found\")\n      plugin(this, pluginConfigs[name])\n    }\n  }\n}\n"]}