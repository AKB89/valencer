{"version":3,"sources":["filter-pipe.js"],"names":[],"mappings":"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","file":"filter-pipe-compiled.js","sourcesContent":["var fstream = require('../fstream.js')\nvar path = require('path')\n\nvar r = fstream.Reader({\n  path: path.dirname(__dirname),\n  filter: function () {\n    return !this.basename.match(/^\\./) &&\n      !this.basename.match(/^node_modules$/) &&\n      !this.basename.match(/^deep-copy$/) &&\n      !this.basename.match(/^filter-copy$/)\n  }\n})\n\n// this writer will only write directories\nvar w = fstream.Writer({\n  path: path.resolve(__dirname, 'filter-copy'),\n  type: 'Directory',\n  filter: function () {\n    return this.type === 'Directory'\n  }\n})\n\nvar indent = ''\n\nr.on('entry', appears)\nr.on('ready', function () {\n  console.error('ready to begin!', r.path)\n})\n\nfunction appears (entry) {\n  console.error(indent + 'a %s appears!', entry.type, entry.basename, typeof entry.basename)\n  if (foggy) {\n    console.error('FOGGY!')\n    var p = entry\n    do {\n      console.error(p.depth, p.path, p._paused)\n      p = p.parent\n    } while (p)\n\n    throw new Error('\\u001b[mshould not have entries while foggy')\n  }\n  indent += '\\t'\n  entry.on('data', missile(entry))\n  entry.on('end', runaway(entry))\n  entry.on('entry', appears)\n}\n\nvar foggy\nfunction missile (entry) {\n  function liftFog (who) {\n    if (!foggy) return\n    if (who) {\n      console.error('%s breaks the spell!', who && who.path)\n    } else {\n      console.error('the spell expires!')\n    }\n    console.error('\\u001b[mthe fog lifts!\\n')\n    clearTimeout(foggy)\n    foggy = null\n    if (entry._paused) entry.resume()\n  }\n\n  if (entry.type === 'Directory') {\n    var ended = false\n    entry.once('end', function () { ended = true })\n    return function (c) {\n      // throw in some pathological pause()/resume() behavior\n      // just for extra fun.\n      process.nextTick(function () {\n        if (!foggy && !ended) { // && Math.random() < 0.3) {\n          console.error(indent + '%s casts a spell', entry.basename)\n          console.error('\\na slowing fog comes over the battlefield...\\n\\u001b[32m')\n          entry.pause()\n          entry.once('resume', liftFog)\n          foggy = setTimeout(liftFog, 1000)\n        }\n      })\n    }\n  }\n\n  return function (c) {\n    var e = Math.random() < 0.5\n    console.error(indent + '%s %s for %d damage!',\n      entry.basename,\n      e ? 'is struck' : 'fires a chunk',\n      c.length)\n  }\n}\n\nfunction runaway (entry) {\n  return function () {\n    var e = Math.random() < 0.5\n    console.error(indent + '%s %s',\n      entry.basename,\n      e ? 'turns to flee' : 'is vanquished!')\n    indent = indent.slice(0, -1)\n  }\n}\n\nw.on('entry', attacks)\n// w.on('ready', function () { attacks(w) })\nfunction attacks (entry) {\n  console.error(indent + '%s %s!', entry.basename,\n    entry.type === 'Directory' ? 'calls for backup' : 'attacks')\n  entry.on('entry', attacks)\n}\n\nvar ended = false\nvar i = 1\nr.on('end', function () {\n  if (foggy) clearTimeout(foggy)\n  console.error(\"\\u001b[mIT'S OVER!!\")\n  console.error('A WINNAR IS YOU!')\n\n  console.log('ok ' + (i++) + ' A WINNAR IS YOU')\n  ended = true\n  // now go through and verify that everything in there is a dir.\n  var p = path.resolve(__dirname, 'filter-copy')\n  var checker = fstream.Reader({ path: p })\n  checker.checker = true\n  checker.on('child', function (e) {\n    var ok = e.type === 'Directory'\n    console.log((ok ? '' : 'not ') + 'ok ' + (i++) +\n      ' should be a dir: ' +\n      e.path.substr(checker.path.length + 1))\n  })\n})\n\nprocess.on('exit', function () {\n  console.log((ended ? '' : 'not ') + 'ok ' + (i) + ' ended')\n  console.log('1..' + i)\n})\n\nr.pipe(w)\n"]}